# All configuration for plugins and other utils is defined here.
# Read more about `setup.cfg`:
# https://docs.python.org/3/distutils/configfile.html

[flake8]
format = wemake
show-source = True
statistics = True
doctests = True
enable-extensions = G

# Flake plugins:
max-line-length = 80
max-complexity = 6
radon-max-cc = 10
radon-show-closures = True
radon-no-assert = True
inline-quotes = double
nested-classes-whitelist = Meta, Media

# Excluding some directories:
exclude = .git,
          __pycache__,
          .venv,
          .eggs,
          *.egg

ignore =
  D100, D104, D106, D401, X100, W503, WPS306, WPS317, WPS121, WPS323, D105,
  WPS115, WPS226, WPS348, E203
;2     C901 'BitField.__init__' is too complex (8)
  C901
;7     CCE001 BitFieldFlags.__getattr__ should be after BitFieldFlags.iteritems
  CCE001
;12    D101 Missing docstring in public class
  D101
;32    D102 Missing docstring in public method
  D102
;25    D103 Missing docstring in public function
  D103
;8     D107 Missing docstring in __init__
  D107
;2     D200 One-line docstring should fit on one line with quotes
  D200
;3     D205 1 blank line required between summary line and description
  D205
;2     D400 First line should end with a period
  D400
;2     E501 line too long (85 > 80 characters)
  E501
;9     E800: Found commented out code
  E800
;4     N806 variable 'XOR_OPERATOR' in function should be lowercase
  N806
;4     PT011 set the match parameter in pytest.raises(ValueError)
  PT011
;1     R701 '__init__' is too complex (12)
  R701
;3     S301 Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.
  S301
;1     S403 Consider possible security implications associated with pickle module.
  S403
;73    WPS110 Found wrong variable name: value
  WPS110
;30    WPS111 Found too short name: i < 2
  WPS111
;14    WPS114 Found underscored name pattern: flags_1
  WPS114
;1     WPS117 Found name reserved for first argument: cls
  WPS117
;2     WPS125 Found builtin shadowing: filter
  WPS125
;1     WPS202 Found too many module members: 12 > 7
  WPS202
;7     WPS204 Found overused expression: isinstance(value, Bit); used 11 > 7
  WPS204
;2     WPS210 Found too many local variables: 7 > 5
  WPS210
;2     WPS211 Found too many arguments: 7 > 5
  WPS211
;4     WPS214 Found too many methods: 10 > 7
  WPS214
;10    WPS218 Found too many `assert` statements: 6 > 5
  WPS218
;3     WPS221 Found line with high Jones Complexity: 15 > 14
  WPS221
;3     WPS229 Found too long ``try`` body length: 2 > 1
  WPS229
;2     WPS231 Found too high function cognitive complexity: 14 > 12
  WPS231
;1     WPS232 Found too high module cognitive complexity: 14.0 > 8
  WPS232
;5     WPS300 Found local folder import
  WPS300
;1     WPS301 Found dotted raw import: os.path
  WPS301
;2     WPS347 Found vague import that may cause confusion: F
  WPS347
;7     WPS412 Found `__init__.py` module with logic
  WPS412
;1     WPS417 Found non-unique item in hash: 100
  WPS417
;1     WPS421 Found wrong function call: hasattr
  WPS421
;8     WPS432 Found magic number: 63
  WPS432
;3     WPS433 Found nested import
  WPS433
;9     WPS437 Found protected attribute usage: _keys
  WPS437
;5     WPS440 Found block variables overlap: flag
  WPS440
;6     WPS441 Found control variable used after block: flag
  WPS441
;1     WPS504 Found negated condition
  WPS504
;1     WPS524 Found self assignment  with refactored assignment
  WPS524
;5     WPS609 Found direct magic attribute usage: __dict__
  WPS609

per-file-ignores =
    tests/**/*.py: S101
    tests/models/__init__.py: F401
    src/*/**/__init__.py: F401

[isort]
# isort configuration:
# https://github.com/timothycrosley/isort/wiki/isort-Settings
include_trailing_comma = true
# See https://github.com/timothycrosley/isort#multi-line-output-modes
multi_line_output = 3
default_section = FIRSTPARTY
# Should be: 80 - 1
line_length = 79
force_grid_wrap = 0
use_parentheses = True

[darglint]
# darglint configuration:
# https://github.com/terrencepreilly/darglint
strictness = long

[mypy]
python_version = 3.8

allow_redefinition = False
check_untyped_defs = True
disallow_any_explicit = True
disallow_any_generics = True
disallow_untyped_calls = True
ignore_errors = False
ignore_missing_imports = True
implicit_reexport = False
strict_equality = True
no_implicit_optional = True
warn_unused_ignores = True
warn_redundant_casts = True
warn_unused_configs = True
warn_unreachable = True
warn_no_return = True

[mypy-server.*.migrations.*]
ignore_errors = True

[mypy-server.apps.*.models]
# FIXME: remove this line, when `django-stubs` will stop
# using `Any` inside.
disallow_any_explicit = False


[doc8]
ignore-path = docs/_build
max-line-length = 80
sphinx = True

[coverage:run]
include = src/*

[tool:pytest]
# Django configuration:
# https://pytest-django.readthedocs.io/en/latest/
;DJANGO_SETTINGS_MODULE = server.settings

# Timeout for tests, so they can not take longer
# than this amout of seconds.
# You should adjust this value to be as low as possible.
# Configuration:
# https://pypi.org/project/pytest-timeout/
timeout = 5

# Directories that are not visited by pytest collector:
norecursedirs = *.egg .eggs dist build docs .tox .git __pycache__

# You will need to measure your tests speed with `-n auto` and without it,
# so you can see whether it gives you any performance gain, or just gives
# you an overhead.
addopts =
    --strict
    --tb=short
    --fail-on-template-vars
    --reuse-db
    --nomigrations
    --cov=server
    --cov=tests
    --cov-branch
    --cov-report=
    --cov-fail-under=70
